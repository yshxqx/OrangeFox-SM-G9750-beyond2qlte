name: 自动解包 boot.img

on:
  workflow_dispatch:  # 手动触发运行

jobs:
  unpack_bootimg:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出你的仓库（包含上传的 boot.img）
      - name: 检出仓库
        uses: actions/checkout@v4

      # 2. 安装必要依赖
      - name: 安装依赖
        run: |
          sudo apt update
          sudo apt install -y git cpio

      # 3. 直接克隆 AIK 仓库（最稳妥，不会有 404）
      - name: 克隆解包工具
        run: git clone https://github.com/osm0sis/Android-Image-Kitchen.git aik

      # 4. 进入工具目录，解包 boot.img
      - name: 解包 boot.img
        run: |
          cd aik
          chmod +x unpackimg.sh
          ./unpackimg.sh ../boot.img

      # 5. 上传解包后的内核文件
      - name: 上传解包结果
        uses: actions/upload-artifact@v4
        with:
          name: Image.gz-dtb
          path: aik/split_img/boot.img-zImage  # 或 aik/split_img/Image.gz-dtb，根据实际生成的文件名调整
          if-no-files-found: error
